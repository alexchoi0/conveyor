apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: etl-operator
  labels:
    app.kubernetes.io/name: etl-operator
    app.kubernetes.io/component: operator
rules:
  # CRD management
  - apiGroups: ["etl.router"]
    resources:
      - sources
      - transforms
      - sinks
      - pipelines
      - etlrouterclusters
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  - apiGroups: ["etl.router"]
    resources:
      - sources/status
      - transforms/status
      - sinks/status
      - pipelines/status
      - etlrouterclusters/status
    verbs: ["get", "update", "patch"]

  # Core resources for cluster management
  - apiGroups: [""]
    resources:
      - pods
      - services
      - configmaps
      - persistentvolumeclaims
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  - apiGroups: [""]
    resources:
      - events
    verbs: ["create", "patch"]

  # StatefulSet management
  - apiGroups: ["apps"]
    resources:
      - statefulsets
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

  # Coordination for leader election
  - apiGroups: ["coordination.k8s.io"]
    resources:
      - leases
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: etl-operator
  labels:
    app.kubernetes.io/name: etl-operator
    app.kubernetes.io/component: operator
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: etl-operator
subjects:
  - kind: ServiceAccount
    name: etl-operator
    namespace: etl-system
